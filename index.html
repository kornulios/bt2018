<html>

<head>
  <script src="./node_modules/axios/dist/axios.js"></script>
  <script src="js/view.js"></script>
  <script src="js/data.js"></script>
  <script src="js/result.js"></script>
  <script src="js/track.js"></script>
  <script src="js/player.js"></script>
  <script src="js/race.js"></script>

  <link rel="stylesheet" href="css/style.css">

</head>

<body>
  <script>
    //main game object
    var game;

    document.addEventListener('DOMContentLoaded', function (e) {
      console.log('up and running');

      class Game {
        constructor() {
          this.gameSpeed = 100;
          this.gameTimer;
          this.gameRunning = false;
          this.view = new View();
          this.race = Object.create(null);
        }
        createRace(players, track) {
          this.race = new Race(players, track);
          this.view.renderPlayers(this.race.players);
        }
        startGame() {
          var me = this;
          me.gameTimer = setInterval(function () {
            if (!me.race.run()) {
              clearInterval(me.gameTimer);
            }
            me.view.renderPlayers(me.race.players);
            me.view.renderResults(me.race.results.getWaypointResults(me.race.track.waypoints.length-1));
          }, me.gameSpeed);

        }
      }
      game = new Game();

      getData().then(function (res) {
        game.createRace(res.data.players, new Track());
      }).catch(function (err) {
        console.log('Data load failed', err);
      });

      function log(data) {
        console.log(data);
      }
    });

    function startGame() {
      if (game) {
        game.startGame();;
      }
    }

  </script>

  <button onclick="startGame();">Start</button>
  <div id="main-view"></div>
  <div id="results-view"></div>
</body>

</html>