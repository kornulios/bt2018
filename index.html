<html>

<head>
  <script src="./node_modules/axios/dist/axios.js"></script>
  <script src="js/view.js"></script>
  <script src="js/data.js"></script>
  <script src="js/result.js"></script>
  <script src="js/track.js"></script>
  <script src="js/player.js"></script>
  <script src="js/race.js"></script>

  <link rel="stylesheet" href="css/style.css">

</head>

<body>
  <script>
    //main game object
    var game;

    document.addEventListener('DOMContentLoaded', function (e) {
      console.log('up and running');

      class Game {
        constructor() {
          this.gameSpeed = 10;
          this.gameTimer;
          this.gameRunning = false;
          this.view = new View();
          this.race = Object.create(null);
        }
        createRace(players, track) {
          this.race = new Race(players, track);
          this.view.renderPlayers(this.race);
        }
        startGame() {
          var me = this;
          me.gameTimer = setInterval(function () {
            if (!me.race.run()) {
              clearInterval(me.gameTimer);
            }
            me.view.renderPlayers(me.race);
            me.view.renderResults(me.race.results.getWaypointResults(me.race.track.waypoints.length - 1));
          }, me.gameSpeed);
        }
        setGameSpeed(val) {
          this.gameSpeed = val;
        }
      }
      game = new Game();

      getData().then(function (res) {
        game.createRace(res.data.players, new Track(trackData[0]));
        game.view.renderTrackInfo(game.race.track);
      }).catch(function (err) {
        console.log('Data load failed', err);
      });

      var startButton = document.getElementById('start-button');
      startButton.addEventListener('click', startGame);

    });

    function startGame() {
      if (game) {
        game.startGame();;
      }
    }

  </script>

  <button id="start-button">Start</button>
  <div id="controls">
    <button>Pause</button>
    <span>Speed: </span>
    <button id="speed-normal" class="btn-ctrl">></button>
    <button id="speed-fast" class="btn-ctrl">>></button>
    <button id="speed-fastest" class="btn-ctrl">>>></button>
  </div>
  <div id="track-info"></div>
  <div id="main-view"></div>
  <div id="results-view"></div>
</body>

</html>